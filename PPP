public Map<String, String> extractAgentMap(String documentJson, AgencyValidationConfig config, Map<String, String> mapForLogs) {
    Map<String, String> extractedMap = new HashMap<>();
    
    // Initial check for null or empty input JSON string (Keep this)
    // ...

    try {
        // 1. Read the JSON document (Keep this)
        JsonNode documentNode = objectMapper.readTree(documentJson);
        
        // Retrieve the list of root nodes from the updated config class
        List<String> rootPaths = config.getRootNodes();

        // Check if root nodes are configured and process them
        if (rootPaths != null && !rootPaths.isEmpty()) {
            
            for (String rootPath : rootPaths) {
                
                // Skip processing if the path is null or empty
                if (!isValid(rootPath)) {
                    continue;
                }

                JsonNode targetNode = documentNode; // Start target from the root document

                // Check if the current root node path exists in the document
                if (documentNode.has(rootPath)) {
                    targetNode = documentNode.get(rootPath);

                    // Check if the retrieved node is null
                    if (targetNode == null || targetNode.isNull()) {
                        logger.warn("Configured Root Node '{}' found but its value is null. Skipping.", rootPath);
                        continue;
                    }

                    // 3. Extract based on structure (Array vs Single Object)
                    if (targetNode == null) {
                        logger.error("Target node is null after root node navigation.");
                        continue;
                    }

                    // Check for the configured array path (e.g., "data": [...])
                    if (isValid(config.getArrayNode())) {
                        String arrayNodePath = config.getArrayNode();
                        
                        // Check if the array path exists in the current target node
                        if (targetNode.has(arrayNodePath)) {
                            JsonNode arrayNode = targetNode.get(arrayNodePath);
                            
                            // Ensure the retrieved node is an array
                            if (arrayNode != null && arrayNode.isArray()) {
                                for (JsonNode item : arrayNode) {
                                    if (item != null) {
                                        addtoMapIfValid(item, config, extractedMap);
                                    }
                                }
                            } else {
                                logger.error("Configured array node '{}' is present but not a valid JSON array in root '{}'.",
                                        arrayNodePath, rootPath);
                            }

                        } else {
                            // Fall through to single object extraction
                        }

                    } else if (targetNode.isArray()) {
                        // Case: Root node itself is an array
                        for (JsonNode item : targetNode) {
                            if (item != null) {
                                addtoMapIfValid(item, config, extractedMap);
                            }
                        }

                    } else if (targetNode.isObject()) {
                        // Case: Single object
                        addtoMapIfValid(targetNode, config, extractedMap);

                    } else {
                        logger.warn("Target node '{}' is neither Array nor Object. Extraction skipped.", rootPath);
                    }

                } else {
                    logger.debug("Configured Root Node '{}' is missing in the document.", rootPath);
                }

            } // end for rootPaths

        } else {
            logger.warn("No root nodes configured for extraction.");
        }

    } catch (Exception e) {
        logger.error("Error extracting agent data: " + e.getMessage(), e);
    }

    return extractedMap; // Return map containing extracted values
}